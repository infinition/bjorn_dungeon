<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bjork Cyberviking - Boss Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #050505;
            font-family: 'Press Start 2P', cursive;
            user-select: none;
            -webkit-user-select: none;
            color: #00ffff;
            /* Cyber Cyan */
            touch-action: none;
            /* EMPÊCHE LE SCROLL SUR MOBILE */
        }

        /* Le Canvas du jeu en basse résolution étiré */
        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            /* CRUCIAL pour le look rétro */
            z-index: 1;
        }

        /* Interface Utilisateur (HUD) */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
            /* Laisser passer les clics vers les contrôles tactiles */
            text-shadow: 2px 2px 0px #000;
        }

        /* Styles spécifiques au HUD */
        .hud-panel {
            background: rgba(0, 20, 20, 0.85);
            border: 2px solid #2a4a4a;
            padding: 8px;
        }

        .bar-container {
            background: #111;
            border: 1px solid #444;
            height: 12px;
            width: 100%;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.2s;
        }

        .text-cyan {
            color: #4deeea;
        }

        .text-orange {
            color: #d68c3e;
        }

        .text-dark {
            pointer-events: auto;
            touch-action: none;
            background: rgba(0, 0, 0, 0.2);
            /* Légère teinte pour mieux voir la zone */
        }

        #stick-left {
            left: 40px;
        }

        #stick-right {
            right: 40px;
        }

        .stick-knob {
            width: 60px;
            /* Knob plus gros pour le confort */
            height: 60px;
            background: rgba(77, 238, 234, 0.5);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            background: rgba(214, 140, 62, 0.5);
            border: 2px solid #d68c3e;
            border-radius: 50%;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            z-index: 20;
            box-shadow: 0 0 10px rgba(214, 140, 62, 0.3);
        }

        #shoot-btn:active {
            background: rgba(214, 140, 62, 0.8);
            transform: scale(0.95);
        }

        /* Minimap */
        #minimap {
            background: #000;
            border: 2px solid #2a4a4a;
            image-rendering: pixelated;
        }

        /* Overlay de démarrage */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
            text-align: center;
        }

        /* Scanlines effet CRT */
        .scanlines {
            background: linear-gradient(to bottom,
                    rgba(255, 255, 255, 0),
                    rgba(255, 255, 255, 0) 50%,
                    rgba(0, 0, 0, 0.2) 50%,
                    rgba(0, 0, 0, 0.2));
            background-size: 100% 4px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 5;
            pointer-events: none;
        }

        .hit-effect {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }
    </style>
</head>

<body>

    <!-- Start Screen -->
    <div id="start-screen">
        <h1 class="text-4xl text-cyan mb-4">BJORK CYBERVIKING</h1>
        <p class="text-orange mb-8 text-xs">BOSS ROOM INCURSION</p>
        <div class="text-xs text-gray-400 mb-8 max-w-md leading-6">
            <p>CONTROLES:</p>
            <p>CLAVIER: ZQSD / Flèches pour bouger. ESPACE pour tirer.</p>
            <p>TACTILE: Joystick Gauche (Bouger), Droit (Viser), Bouton (Tirer)</p>
            <p>MANETTE: Stick Gauche (Bouger), Droit (Viser), RT (Tirer)</p>
        </div>
        <button id="start-btn"
            class="px-6 py-3 border-2 border-cyan text-cyan hover:bg-cyan-900 transition text-sm blink">
            COMMENCER LA RAID
        </button>
    </div>

    <!-- UI Overlay -->
    <div id="ui-layer" class="hidden flex flex-col justify-between p-2">

        <!-- Top Bar -->
        <div class="flex justify-between items-start w-full">
            <!-- Stats Gauche -->
            <div class="w-1/3">
                <div class="text-cyan text-sm mb-1">BJORK Cyberviking</div>
                <div class="flex items-center text-xs mb-1">
                    <span class="mr-2">Lv 7</span>
                    <div class="bar-container w-24 mr-2">
                        <div class="bar-fill bg-cyan-600" style="width: 57%;"></div>
                    </div>
                    <span class="text-gray-400">XP 230/400</span>
                </div>
            </div>

            <!-- Stats Centre -->
            <div class="w-1/3 text-center pt-2">
                <span class="text-orange text-xs mr-4">Gold 128</span>
                <span class="text-cyan text-xs">Honor 22</span>
            </div>

            <!-- Stats Droite + Minimap -->
            <div class="w-1/3 flex flex-col items-end">
                <div class="flex items-center w-full justify-end mb-1">
                    <span class="text-cyan text-xs mr-2">HP</span>
                    <div class="bar-container w-32">
                        <div id="hp-bar" class="bar-fill bg-red-600" style="width: 100%;"></div>
                    </div>
                </div>
                <div class="text-cyan text-xs mb-1 text-right w-full">Boss Room</div>
                <canvas id="minimap" width="80" height="80" class="mt-1"></canvas>
            </div>
        </div>

        <!-- Crosshair -->
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none">
            <div class="w-1 h-4 bg-cyan-400 absolute left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
            <div class="w-4 h-1 bg-cyan-400 absolute top-1/2 -translate-y-1/2 -translate-x-1/2"></div>
        </div>

        <!-- Damage Overlay -->
        <div id="damage-overlay"
            class="absolute top-0 left-0 w-full h-full bg-red-500 opacity-0 pointer-events-none transition-opacity duration-75">
        </div>

        <!-- Bottom Bar -->
        <div class="flex justify-between items-end w-full mt-auto">

            <!-- Skills -->
            <div class="hud-panel w-48 h-24 flex flex-col justify-between pointer-events-auto">
                <!-- Pointer events auto pour cliquer si besoin -->
                <div class="flex justify-between text-cyan text-[10px] mb-1">
                    <span>Lightning</span>
                    <span>Rune</span>
                </div>
                <div class="flex space-x-2">
                    <div class="w-10 h-10 border border-cyan-800 flex items-center justify-center text-cyan bg-black">⚡
                    </div>
                    <div class="w-10 h-10 border border-cyan-800 flex items-center justify-center text-cyan bg-black">†
                    </div>
                    <div class="w-10 h-10 border border-cyan-800 flex items-center justify-center text-cyan bg-black">◇
                    </div>
                    <div class="w-10 h-10 border border-cyan-800 flex items-center justify-center text-cyan bg-black">F
                    </div>
                </div>
                <div class="bar-container h-1 mt-1">
                    <div class="bar-fill bg-orange-500" style="width: 100%;"></div>
                </div>
            </div>

            <!-- Charge Bar (Middle) -->
            <div class="hud-panel w-64 h-12 flex items-center justify-center mx-2 mb-4">
                <div id="boss-hp-label" class="hidden text-xs text-red-500 mr-2">BOSS</div>
                <div class="bar-container w-full h-4">
                    <div id="boss-hp-bar" class="bar-fill bg-red-800" style="width: 100%;"></div>
                </div>
            </div>

            <!-- Log -->
            <div class="flex flex-col items-end">
                <div class="hud-panel mb-2 text-cyan text-xs px-2 py-1">Log</div>
                <div class="hud-panel w-48 h-24 overflow-hidden flex flex-col justify-end text-[10px] leading-4"
                    id="game-log">
                    <div class="text-orange">Boss enragé!</div>
                    <div class="text-orange">Rune de Givre activée</div>
                    <div class="text-gray-400">Entrée dans le donjon...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Modal (Hidden by default) -->
    <div id="inventory-modal"
        class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black border-2 border-cyan p-4 w-80 h-96 z-50 pointer-events-auto">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-cyan text-sm">INVENTAIRE</h2>
            <button id="close-inventory" class="text-red-500 text-xs">X</button>
        </div>

        <!-- Equipment Slots -->
        <div class="flex justify-center space-x-4 mb-4">
            <div id="slot-mainhand"
                class="w-12 h-12 border border-gray-600 bg-gray-900 flex items-center justify-center text-xs text-gray-500">
                MAIN</div>
            <div id="slot-armor"
                class="w-12 h-12 border border-gray-600 bg-gray-900 flex items-center justify-center text-xs text-gray-500">
                ARMOR</div>
            <div id="slot-offhand"
                class="w-12 h-12 border border-gray-600 bg-gray-900 flex items-center justify-center text-xs text-gray-500">
                OFF</div>
        </div>

        <!-- Grid -->
        <div id="inventory-grid" class="grid grid-cols-5 gap-2 overflow-y-auto h-60">
            <!-- Slots generated by JS -->
        </div>
    </div>

    <!-- Inventory Toggle Button -->
    <button id="toggle-inventory"
        class="absolute top-16 right-2 w-10 h-10 border border-cyan bg-black text-cyan flex items-center justify-center pointer-events-auto">
        I
    </button>
    </div>

    <!-- Touch Controls (Visible on touch devices) -->
    <div id="touch-controls" class="hidden">
        <div id="stick-left" class="touch-zone">
            <div class="stick-knob"></div>
        </div>
        <div id="stick-right" class="touch-zone">
            <div class="stick-knob"></div>
        </div>
        <div id="shoot-btn">ATTACK</div>
    </div>

    <div class="scanlines"></div>
    <div id="canvas-container"></div>

    <script type="module" src="js/game.js"></script>
</body>

</html>